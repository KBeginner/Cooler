<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>文件分片上传</title>
</head>

<body>
    <div>
        <input type="file" id='f' />
    </div>
</body>
<script type="text/javascript">
    function upload(blob) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/ajax', true);
        xhr.setRequestHeader('Content-Type', 'text/plain')
        xhr.send(blob);
    }

    document.getElementById('f').addEventListener('change', function (e) {
        var blob = this.files[0];
        const CHUNK_SIZE = 20;
        const SIZE = blob.size;
        var start = 0;
        var end = CHUNK_SIZE;
        while (start < SIZE) {
            upload(blob.slice(start, end));
            start = end;
            end = start + CHUNK_SIZE;
        }
    }, false);

    /*
        // Node端(Koa)
        app.use(async (ctx, next) => {
            await next();
            if (ctx.path === '/ajax') {
                const req = ctx.req;
                const body = await parse(req);
                ctx.status = 200;
                console.log(body);
                console.log('---------------');
            }
        });
    */

</script>

</html>